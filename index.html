<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stadt-Land-Fluss - Spiel</title>
  <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
  <style>
    /* CSS bleibt dasselbe wie in der vorherigen Version */
  </style>
</head>
<body>
  <div class="container">
    <h1 id="game-title">Stadt-Land-Fluss</h1>
    
    <!-- Die Ansichten (Views) bleiben strukturell identisch -->
    <div id="lobby" class="view">...</div>
    <div id="game-area" class="view">
        <div class="info-box">
            <span>Buchstabe: <span id="buchstabe"></span></span>
            <span>Zeit: <span id="countdown"></span>s</span>
        </div>
        <form id="playerForm">...</form>
    </div>
    <div id="loading" class="view">...</div>
    <div id="results-area" class="view">...</div>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const hostId = urlParams.get('hostId');
    const isCreatingGame = urlParams.get('createGame') === 'true';
    const gameName = urlParams.get('gameName') || "Anonymes Spiel";
    const myName = urlParams.get('playerName') || "Spieler" + Math.floor(Math.random() * 1000);
    let kategorien = (urlParams.get('kategorien') || 'Stadt,Land,Fluss').split(',');
    // NEU: Spielzeit aus der URL lesen
    let spielzeit = parseInt(urlParams.get('spielzeit'), 10) || 60;

    let peer, myPeerId, isHost = isCreatingGame, connections = {}, hostConnection, buchstabe, gameIdInLobby;
    // ... alle UI-Elemente wie zuvor ...

    // ... die UI-Steuerung und Peer-Initialisierung bleiben identisch ...

    async function setupHost() {
        // ...
        // NEU: Beim Registrieren des Spiels in der Lobby werden jetzt auch Kategorien und Spielzeit mitgesendet
        try {
            const response = await fetch('/api/games', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ gameName, hostId: myPeerId, hostName: myName, kategorien, spielzeit })
            });
            // ...
        } catch (error) { /* ... */ }
        // ...
    }

    function handleData(conn, data) {
        switch(data.type) {
            case 'welcome':
                // Client lernt jetzt auch die Kategorien und Spielzeit vom Host
                kategorien = data.kategorien;
                spielzeit = data.spielzeit;
                updatePlayerList(data.players);
                break;
            case 'start-game':
                // Spielzeit wird nicht mehr übergeben, da sie schon bekannt ist
                startGame(data.buchstabe);
                break;
            // ... andere cases ...
        }
    }

    function startGame(b) {
        buchstabe = b;
        showView('game-area');
        buchstabeEl.textContent = buchstabe;
        inputsContainer.innerHTML = '';
        kategorien.forEach(k => { /* ... */ });
        
        // NEU: Die Countdown-Zeit wird jetzt von der `spielzeit`-Variable genommen
        let timeLeft = spielzeit;
        countdownEl.textContent = timeLeft;
        const timer = setInterval(() => {
            timeLeft--;
            countdownEl.textContent = timeLeft;
            if (timeLeft <= 0) {
                clearInterval(timer);
                endRound();
            }
        }, 1000);
    }
    
    // Der Rest des Codes (endRound, evaluateAllAnswers, etc.) bleibt
    // funktional sehr ähnlich und muss nicht gezeigt werden.
  </script>
</body>
</html>
